<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VIA Forças de Caráter - Impulso Coaching</title>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333; min-height: 100vh; padding: 20px;
    }
    .container { max-width: 1000px; margin: 0 auto; }
    .card {
      background: white; border-radius: 20px; padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15); margin-bottom: 25px;
    }
    /* Cabeçalho fixo */
    .header-brand {
      text-align: center;
      font-weight: 700;
      font-size: 1.4em;
      color: #5a67d8;
      margin-bottom: 15px;
    }
    /* Rodapé fixo */
    .footer-note {
      text-align: center;
      font-style: italic;
      color: #667eea;
      margin-top: 25px;
      font-size: 1.05em;
      font-weight: 500;
    }
    h1 {
      text-align: center; color: #5a67d8; font-size: 1.8em; margin-bottom: 10px;
      font-weight: 700;
    }
    .subtitle { text-align: center; color: #718096; margin-bottom: 25px; }
    .form-row {
      display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 20px;
    }
    .form-group {
      flex: 1; min-width: 200px;
    }
    .form-group label {
      display: block; font-weight: 600; margin-bottom: 6px; color: #4a5568;
    }
    .form-group input {
      width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px;
      font-size: 1em; background: #f8fafc;
    }
    .form-group input:focus {
      outline: none; border-color: #667eea;
    }
    /* Barra de progresso */
    .progress-container {
      text-align: center;
      margin-bottom: 20px;
      font-weight: 600;
      color: #4a5568;
      font-size: 1.1em;
    }
    .progress-bar {
      height: 8px; background: #e2e8f0; border-radius: 4px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%; background: linear-gradient(to right, #48bb78, #38a169);
      width: 0%; transition: width 0.4s ease;
    }
    /* Cabeçalho das opções */
    .options-header {
      display: flex;
      align-items: center;
      padding: 0 10px;
      margin-bottom: 15px;
    }
    .options-header .affirmation-label {
      flex: 1;
      font-weight: 600;
      color: #2d3748;
    }
    .options-row {
      display: flex;
      justify-content: space-between;
      width: 520px;
    }
    .option-label {
      text-align: center;
      font-size: 0.78em;
      color: #4a5568;
      width: 95px;
      white-space: normal;
      line-height: 1.3;
    }
    /* Linha de afirmação */
    .affirmation-row {
      display: flex;
      align-items: center;
      padding: 16px 10px;
      margin-bottom: 12px;
      background: #fafcff;
      border-radius: 10px;
      transition: background 0.2s;
    }
    .affirmation-text {
      flex: 1;
      font-size: 1.05em;
      color: #2d3748;
      line-height: 1.4;
    }
    .response-options {
      display: flex;
      justify-content: space-between;
      width: 520px;
    }
    .radio-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      width: 95px;
    }
    .radio-option input[type="radio"] {
      display: none;
    }
    .radio-circle {
      width: 24px;
      height: 24px;
      border: 2px solid #cbd5e0;
      border-radius: 50%;
      background: white;
      margin-bottom: 6px;
      transition: all 0.25s ease;
    }
    .radio-option input[type="radio"]:checked + .radio-circle {
      background: #667eea;
      border-color: #667eea;
      transform: scale(1.2);
    }
    /* Botões */
    .nav-buttons {
      text-align: center;
      margin-top: 25px;
    }
    .btn {
      padding: 12px 24px; border: none; border-radius: 12px;
      font-size: 1em; font-weight: 600; cursor: pointer;
      margin: 0 8px;
      background: #667eea; color: white;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(102, 126, 234, 0.4); }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .btn-prev { background: #cbd5e0; color: #4a5568; }
    .btn-next, .btn-submit { background: linear-gradient(to right, #667eea, #764ba2); }
    /* Relatório */
    #report { display: none; }
    .page-break { page-break-after: always; }
    @media print {
      body { background: white; padding: 0; }
      .card, .container { box-shadow: none; border-radius: 0; }
      .no-print { display: none !important; }
    }
    .strength-item {
      margin: 25px 0; padding: 15px; border-left: 4px solid #667eea;
      background: #f8fafc; border-radius: 8px;
    }
    .explanation {
      background: #f0f9ff; padding: 20px; border-radius: 12px; margin: 25px 0;
      border-left: 4px solid #3182ce;
    }
    .signature {
      text-align: center; margin-top: 40px; font-style: italic; color: #4a5568;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Etapa 1 -->
    <div id="step1" class="card">
      <div class="header-brand">Impulso Coaching</div>
      <h1>Forças de Caráter</h1>
      <p class="subtitle">Descubra seu perfil completo de forças de caráter</p>
      <div class="form-row">
        <div class="form-group">
          <label class="required">Nome Completo *</label>
          <input type="text" id="fullName" placeholder="Ex: João Silva" required>
        </div>
        <div class="form-group">
          <label>Email *</label>
          <input type="email" id="email" placeholder="seu@email.com" required>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Idade</label>
          <input type="number" id="age" placeholder="30" min="1" max="120">
        </div>
        <div class="form-group">
          <label>Profissão</label>
          <input type="text" id="profession" placeholder="Ex: Professor">
        </div>
      </div>
      <div class="card" style="background:#f0f9ff; border-left:4px solid #3182ce; margin-top:20px;">
        <h3>Como responder?</h3>
        <p style="margin-top:10px; line-height:1.6;">
          Leia cada afirmação e escolha a opção que melhor representa <strong>com que frequência você age assim na vida real</strong>.
        </p>
        <p style="margin-top:15px;">Responda com sinceridade — não há respostas certas ou erradas!</p>
      </div>
      <div class="footer-note">A mudança pode acontecer em um instante.</div>
      <button class="btn btn-next" onclick="startSurvey()">Começar Questionário</button>
    </div>

    <!-- Etapa 2: Perguntas (10 por página) -->
    <div id="surveyStep" class="card" style="display:none;">
      <div class="header-brand">Impulso Coaching</div>
      
      <div class="progress-container">
        <div id="progressPercent">0%</div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
      </div>

      <!-- Cabeçalho das opções -->
      <div class="options-header">
        <div class="affirmation-label">Afirmação</div>
        <div class="options-row">
          <div class="option-label">Tem tudo a ver comigo</div>
          <div class="option-label">Tem a ver comigo</div>
          <div class="option-label">Neutro</div>
          <div class="option-label">Não tem a ver comigo</div>
          <div class="option-label">Não tem nada a ver comigo</div>
        </div>
      </div>

      <!-- Lista de afirmações -->
      <div id="affirmationsList"></div>

      <div class="nav-buttons">
        <button class="btn btn-prev" id="btnPrevPage" onclick="prevPage()" disabled>Anterior</button>
        <button class="btn btn-next" id="btnNextPage" onclick="nextPage()">Próxima</button>
        <button class="btn btn-submit" id="btnSubmit" style="display:none;" onclick="finishSurvey()">Finalizar</button>
      </div>

      <div class="footer-note">A mudança pode acontecer em um instante.</div>
    </div>

    <!-- Etapa 3: Relatório -->
    <div id="report" class="card" style="display:none;">
      <div class="header-brand">Impulso Coaching</div>
      <h1>Relatório VIA – Forças de Caráter</h1>
      <p><strong>Cliente:</strong> <span id="reportName"></span> | 
         <strong>Data:</strong> <span id="reportDate"></span></p>
      <hr style="margin:20px 0; border:1px dashed #cbd5e0;">
      <h2 style="color:#667eea; text-align:center; margin:25px 0;">Suas 5 Forças Signature</h2>
      <div id="top5"></div>
      <div class="page-break"></div>
      <h2 style="color:#667eea; text-align:center; margin:25px 0;">Forças por Categoria (Virtudes)</h2>
      <div id="categorizedReport"></div>
      <div class="explanation">
        <h3>Significado das Forças de Caráter</h3>
        <p>As <strong>24 forças de caráter</strong> do VIA são qualidades universais da personalidade que, quando usadas com frequência, promovem bem-estar, realização e resiliência. Elas são agrupadas em 6 virtudes:</p>
        <ul style="margin:15px 0; padding-left:25px; line-height:1.7;">
          <li><strong>Sabedoria</strong>: Criatividade, Curiosidade, Julgamento, Amor pelo Aprendizado, Perspectiva</li>
          <li><strong>Coragem</strong>: Coragem, Perseverança, Integridade, Entusiasmo</li>
          <li><strong>Humanidade</strong>: Bondade, Amor, Inteligência Social</li>
          <li><strong>Justiça</strong>: Trabalho em Equipe, Equidade, Liderança</li>
          <li><strong>Temperança</strong>: Perdão, Humildade, Prudência, Autocontrole</li>
          <li><strong>Transcendência</strong>: Apreciação da Beleza, Gratidão, Esperança, Humor, Espiritualidade</li>
        </ul>
      </div>
      <div class="signature">
        <strong>Rogério Braga</strong><br>
        Coach Executivo & Mentor<br>
        impulsoflow@gmail.com
      </div>
      <div class="footer-note">A mudança pode acontecer em um instante.</div>
      <div class="no-print" style="text-align:center; margin-top:30px;">
        <button class="btn" onclick="autoSaveAndEmail()">Salvar e Enviar Relatório</button>
      </div>
    </div>
  </div>

  <script>
    // === CONFIG EmailJS ===
    const EMAILJS_SERVICE_ID = 'YOUR_SERVICE_ID';
    const EMAILJS_TEMPLATE_ID = 'YOUR_TEMPLATE_ID';
    const EMAILJS_PUBLIC_KEY = 'YOUR_PUBLIC_KEY';
    (function() { emailjs.init(EMAILJS_PUBLIC_KEY); })();
    const { jsPDF } = window.jspdf;

    // ... (mantenha strengthData e questions exatamente como no seu via5.txt) ...
    const strengthData = [
      { name: "Criatividade", desc: "Você gera ideias novas e originais. Gosta de pensar em soluções diferentes e criativas para problemas do dia a dia. Sua mente é imaginativa e inventiva." },
      { name: "Curiosidade", desc: "Você explora o mundo com interesse genuíno. Faz perguntas, investiga e se fascina pelo desconhecido. Está sempre aberto a novas experiências." },
      { name: "Julgamento", desc: "Você pensa criticamente e analisa situações com cuidado. Pesa prós e contras, evita conclusões precipitadas e muda de ideia com novas evidências." },
      { name: "Amor pelo Aprendizado", desc: "Você ama adquirir novos conhecimentos e habilidades. Lê, estuda e se sente animado ao dominar algo novo. O aprendizado é uma fonte de prazer." },
      { name: "Perspectiva", desc: "Você oferece sabedoria e visão ampla. Vê o 'quadro geral', dá conselhos profundos e ajuda os outros a encontrarem clareza em momentos difíceis." },
      { name: "Coragem", desc: "Você enfrenta medos e desafios com valentia. Defende suas crenças, fala a verdade sob pressão e assume riscos calculados quando necessário." },
      { name: "Perseverança", desc: "Você termina o que começa, mesmo com obstáculos. Mantém o foco em metas longas, trabalha duro e não desiste facilmente." },
      { name: "Integridade", desc: "Você é honesto, autêntico e age de acordo com seus valores. Cumpre promessas, evita mentiras e vive com transparência." },
      { name: "Entusiasmo", desc: "Você vive com energia e paixão. Aborda a vida com excitação, contagia os outros e se empolga facilmente com novas ideias." },
      { name: "Bondade", desc: "Você ajuda os outros com generosidade e sem esperar nada em troca. Pratica atos de gentileza diariamente e se preocupa com o bem-estar alheio." },
      { name: "Amor", desc: "Você forma vínculos profundos e carinhosos. Valoriza relacionamentos íntimos, demonstra afeto e prioriza tempo com quem ama." },
      { name: "Inteligência Social", desc: "Você entende emoções e dinâmicas entre pessoas. Lê sinais sociais, sabe confortar, adapta-se ao contexto e ajuda a resolver conflitos." },
      { name: "Trabalho em Equipe", desc: "Você colabora bem em grupos, é leal e contribui para o sucesso coletivo. Celebra vitórias do time e coloca o grupo acima do ego." },
      { name: "Equidade", desc: "Você trata todos com justiça e imparcialidade. Evita favoritismos, defende a igualdade e julga pelas ações, não pelas aparências." },
      { name: "Liderança", desc: "Você guia e motiva grupos com confiança. Organiza projetos, inspira os outros e toma decisões difíceis quando necessário." },
      { name: "Perdão", desc: "Você libera ressentimentos e perdoa quem errou. Dá segundas chances, escolhe a paz e não guarda mágoas do passado." },
      { name: "Humildade", desc: "Você deixa seus feitos falarem por si. Não se gaba, aprende com os outros, admite erros e valoriza todas as contribuições." },
      { name: "Prudência", desc: "Você pensa antes de agir e evita riscos desnecessários. Planeja com cuidado, pesa consequências e toma decisões conscientes." },
      { name: "Autocontrole", desc: "Você regula emoções, impulsos e desejos. Resiste a tentações, mantém a calma sob pressão e evita excessos." },
      { name: "Apreciação da Beleza", desc: "Você se emociona com a natureza, arte e excelência. Para para admirar o belo no dia a dia e se sente inspirado por ele." },
      { name: "Gratidão", desc: "Você reconhece e valoriza as coisas boas da vida. Expressa gratidão aos outros e mantém uma atitude de apreciação, mesmo em dias difíceis." },
      { name: "Esperança", desc: "Você mantém otimismo e acredita em um futuro melhor. Planeja com confiança, se recupera de decepções e vê oportunidades nos desafios." },
      { name: "Humor", desc: "Você vê o lado leve da vida. Ri facilmente, usa o humor para aliviar tensões e gosta de fazer os outros rirem." },
      { name: "Espiritualidade", desc: "Você busca propósito e conexão com algo maior. Reflete sobre o sentido da vida e encontra paz em práticas espirituais ou contemplativas." }
    ];

    const questions = [
      "Eu penso em novas maneiras de fazer as coisas.",
      "Eu gosto de inventar soluções originais.",
      "Eu crio coisas novas regularmente.",
      "Eu uso a imaginação para resolver problemas.",
      "Eu sou criativo no meu trabalho ou hobbies.",
      "Eu faço muitas perguntas sobre o mundo.",
      "Eu exploro coisas novas por curiosidade.",
      "Eu me interesso por temas desconhecidos.",
      "Eu gosto de investigar como as coisas funcionam.",
      "Eu sou fascinado pelo desconhecido.",
      "Eu analiso prós e contras antes de decidir.",
      "Eu evito tirar conclusões precipitadas.",
      "Eu penso criticamente sobre as informações.",
      "Eu considero múltiplos pontos de vista.",
      "Eu mudo de ideia com novas evidências.",
      "Eu leio para aprender coisas novas.",
      "Eu gosto de dominar novas habilidades.",
      "Eu me sinto animado ao aprender.",
      "Eu busco conhecimento por prazer.",
      "Eu estudo tópicos por conta própria.",
      "Eu dou conselhos sábios aos outros.",
      "Eu vejo o 'quadro geral' nas situações.",
      "Eu ajudo os outros a terem clareza.",
      "Eu reflito sobre a vida com profundidade.",
      "Eu ofereço insights valiosos.",
      "Eu enfrento meus medos.",
      "Eu defendo o que acredito.",
      "Eu falo a verdade mesmo sob pressão.",
      "Eu assumo riscos calculados.",
      "Eu supero obstáculos com valentia.",
      "Eu termino o que começo.",
      "Eu persisto apesar das dificuldades.",
      "Eu mantenho o foco em metas longas.",
      "Eu não desisto facilmente.",
      "Eu trabalho duro até concluir.",
      "Eu sou honesto em tudo que faço.",
      "Eu cumpro minhas promessas.",
      "Eu ajo de acordo com meus valores.",
      "Eu sou autêntico com os outros.",
      "Eu evito mentir ou enganar.",
      "Eu me sinto cheio de energia pela vida.",
      "Eu abordo tarefas com entusiasmo.",
      "Eu me empolgo facilmente com ideias.",
      "Eu vivo com paixão.",
      "Eu contagio os outros com minha energia.",
      "Eu ajudo os outros sem esperar retorno.",
      "Eu faço favores espontaneamente.",
      "Eu sou gentil com estranhos.",
      "Eu me preocupo com o bem-estar alheio.",
      "Eu pratico atos de bondade diariamente.",
      "Eu demonstro afeto às pessoas próximas.",
      "Eu valorizo relacionamentos íntimos.",
      "Eu me sinto amado e amo em troca.",
      "Eu priorizo tempo com quem amo.",
      "Eu sou carinhoso e atencioso.",
      "Eu percebo as emoções dos outros.",
      "Eu sei como confortar alguém.",
      "Eu adapto meu comportamento ao contexto.",
      "Eu leio bem 'sinais sociais'.",
      "Eu ajudo a resolver conflitos.",
      "Eu coopero bem em grupos.",
      "Eu contribuo para o sucesso da equipe.",
      "Eu sou leal aos meus colegas.",
      "Eu celebro vitórias do time.",
      "Eu coloco o grupo acima do ego.",
      "Eu trato todos com justiça.",
      "Eu evito favoritismos.",
      "Eu defendo a igualdade.",
      "Eu julgo pelas ações, não aparências.",
      "Eu sou imparcial em decisões.",
      "Eu organizo e guio grupos.",
      "Eu motivo os outros a darem o melhor.",
      "Eu assumo responsabilidade em projetos.",
      "Eu inspiro confiança.",
      "Eu tomo decisões difíceis quando necessário.",
      "Eu perdoo quem me magoou.",
      "Eu libero rancores.",
      "Eu dou segundas chances.",
      "Eu não guardo mágoa.",
      "Eu escolho a paz em vez do ressentimento.",
      "Eu deixo meus feitos falarem por si.",
      "Eu não me gabo das conquistas.",
      "Eu aprendo com os outros.",
      "Eu admito quando erro.",
      "Eu valorizo todas as contribuições.",
      "Eu penso antes de agir.",
      "Eu evito riscos desnecessários.",
      "Eu planejo com cuidado.",
      "Eu peso consequências.",
      "Eu sou cauteloso com escolhas.",
      "Eu controlo meus impulsos.",
      "Eu resisto a tentações.",
      "Eu mantenho a calma sob pressão.",
      "Eu regulo minhas emoções.",
      "Eu evito excessos.",
      "Eu paro para admirar a natureza.",
      "Eu me emociono com arte ou música.",
      "Eu noto beleza no dia a dia.",
      "Eu aprecio excelência em qualquer área.",
      "Eu me sinto inspirado pela beleza.",
      "Eu agradeço pelas coisas boas.",
      "Eu expresso gratidão aos outros.",
      "Eu mantenho um diário de gratidão.",
      "Eu valorizo o que tenho.",
      "Eu sou grato mesmo em dias ruins.",
      "Eu acredito em um futuro melhor.",
      "Eu mantenho o otimismo.",
      "Eu planejo com confiança.",
      "Eu me recupero de decepções.",
      "Eu vejo oportunidades em desafios.",
      "Eu rio facilmente.",
      "Eu faço piadas para aliviar o clima.",
      "Eu vejo o lado engraçado da vida.",
      "Eu uso humor para lidar com estresse.",
      "Eu gosto de fazer os outros rirem.",
      "Eu sinto conexão com algo maior.",
      "Eu busco propósito na vida.",
      "Eu reflito sobre o sentido da existência.",
      "Eu pratico meditação ou oração.",
      "Eu encontro paz em práticas espirituais."
    ];

    let currentPage = 0;
    const QUESTIONS_PER_PAGE = 10;
    let answers = new Array(questions.length).fill(null);

    function startSurvey() {
      const name = document.getElementById('fullName').value.trim();
      const email = document.getElementById('email').value.trim();
      if (!name || !email) {
        alert("Preencha Nome e Email!");
        return;
      }
      document.getElementById('step1').style.display = 'none';
      document.getElementById('surveyStep').style.display = 'block';
      renderPage(0);
    }

    function renderPage(page) {
      currentPage = page;
      const start = page * QUESTIONS_PER_PAGE;
      const end = Math.min(start + QUESTIONS_PER_PAGE, questions.length);
      
      let html = '';
      for (let i = start; i < end; i++) {
        html += `
          <div class="affirmation-row">
            <div class="affirmation-text">${questions[i]}</div>
            <div class="response-options">
              ${[5,4,3,2,1].map(val => `
                <label class="radio-option">
                  <input type="radio" name="q${i}" value="${val}" ${answers[i] == val ? 'checked' : ''} onchange="answers[${i}] = ${val}; updateProgress();">
                  <span class="radio-circle"></span>
                </label>
              `).join('')}
            </div>
          </div>
        `;
      }
      document.getElementById('affirmationsList').innerHTML = html;

      document.getElementById('btnPrevPage').disabled = page === 0;
      document.getElementById('btnNextPage').style.display = end < questions.length ? 'inline-block' : 'none';
      document.getElementById('btnSubmit').style.display = end >= questions.length ? 'inline-block' : 'none';

      updateProgress();
    }

    function updateProgress() {
      const total = questions.length;
      const answered = answers.filter(a => a !== null).length;
      const percent = Math.round((answered / total) * 100);
      document.getElementById('progressFill').style.width = `${percent}%`;
      document.getElementById('progressPercent').textContent = `${percent}%`;
    }

    function nextPage() {
      const start = currentPage * QUESTIONS_PER_PAGE;
      const end = Math.min(start + QUESTIONS_PER_PAGE, questions.length);
      // Verificar se todas as 10 estão respondidas
      for (let i = start; i < end; i++) {
        if (answers[i] === null) {
          alert("Por favor, responda todas as afirmações desta página antes de continuar.");
          return;
        }
      }
      renderPage(currentPage + 1);
    }

    function prevPage() {
      renderPage(currentPage - 1);
    }

    function finishSurvey() {
      // Verificação final
      const unanswered = answers.findIndex(a => a === null);
      if (unanswered !== -1) {
        alert("Por favor, responda todas as afirmações.");
        return;
      }

      const scores = strengthData.map((s, idx) => {
        let sum = 0;
        for (let i = 0; i < 5; i++) {
          sum += answers[idx * 5 + i] || 0;
        }
        return { ...s, score: (sum / 5).toFixed(2) };
      });

      const sorted = [...scores].sort((a, b) => b.score - a.score);
      const name = document.getElementById('fullName').value;
      document.getElementById('reportName').textContent = name;
      document.getElementById('reportDate').textContent = new Date().toLocaleDateString('pt-BR');

      const top5 = sorted.slice(0, 5).map((s, i) => createStrengthBlock(s, i + 1, true)).join('');
      document.getElementById('top5').innerHTML = top5;
      renderCategorizedReport(scores);

      document.getElementById('surveyStep').style.display = 'none';
      document.getElementById('report').style.display = 'block';
      window.scrollTo(0, 0);
    }

    function renderCategorizedReport(scores) {
      const virtues = [
        { name: "Sabedoria", strengths: ["Criatividade", "Curiosidade", "Julgamento", "Amor pelo Aprendizado", "Perspectiva"] },
        { name: "Coragem", strengths: ["Coragem", "Perseverança", "Integridade", "Entusiasmo"] },
        { name: "Humanidade", strengths: ["Bondade", "Amor", "Inteligência Social"] },
        { name: "Justiça", strengths: ["Trabalho em Equipe", "Equidade", "Liderança"] },
        { name: "Temperança", strengths: ["Perdão", "Humildade", "Prudência", "Autocontrole"] },
        { name: "Transcendência", strengths: ["Apreciação da Beleza", "Gratidão", "Esperança", "Humor", "Espiritualidade"] }
      ];

      let html = '';
      virtues.forEach(virtue => {
        html += `<h3 style="color:#5a67d8; margin:25px 0 15px; border-bottom:1px solid #e2e8f0; padding-bottom:8px;">${virtue.name}</h3>`;
        virtue.strengths.forEach(strengthName => {
          const strength = scores.find(s => s.name === strengthName);
          if (strength) {
            html += createStrengthBlock(strength, null, false);
          }
        });
      });
      document.getElementById('categorizedReport').innerHTML = html;
    }

    function createStrengthBlock(s, rank = null, isTop5 = false) {
      const percent = (parseFloat(s.score) / 5) * 100;
      let color = '#667eea';
      if (isTop5) color = '#28a745';
      return `
        <div class="strength-item">
          <h3>${rank ? `${rank}. ` : ''}${s.name} <em>(${s.score}/5.00)</em></h3>
          <div style="height:10px; background:#e2e8f0; border-radius:5px; margin:10px 0;">
            <div style="height:100%; background:${color}; width:${percent}%; border-radius:5px;"></div>
          </div>
          <p style="margin-top:10px;">${s.desc}</p>
        </div>
      `;
    }

    async function autoSaveAndEmail() {
      const reportDiv = document.getElementById('report');
      const name = document.getElementById('fullName').value;
      const email = document.getElementById('email').value;

      // Salvar HTML
      const htmlBlob = new Blob([document.documentElement.outerHTML], { type: 'text/html;charset=utf-8' });
      const htmlUrl = URL.createObjectURL(htmlBlob);
      const a1 = document.createElement('a');
      a1.href = htmlUrl;
      a1.download = `VIA_${name.replace(/\s+/g, '_')}.html`;
      a1.click();
      URL.revokeObjectURL(htmlUrl);

      // Salvar PDF
      reportDiv.style.display = 'block';
      const canvas = await html2canvas(reportDiv, { scale: 2, backgroundColor: '#ffffff', useCORS: true });
      const imgData = canvas.toDataURL('image/png');
      const pdf = new jsPDF('p', 'mm', 'a4');
      const width = pdf.internal.pageSize.getWidth();
      const height = (canvas.height * width) / canvas.width;
      pdf.addImage(imgData, 'PNG', 0, 0, width, Math.min(height, 297));
      pdf.save(`VIA_${name.replace(/\s+/g, '_')}.pdf`);

      // Enviar por e-mail
      const templateParams = {
        to_email: 'impulsoflow@gmail.com',
        nome: name,
        data: new Date().toLocaleDateString('pt-BR'),
        relatorio_html: reportDiv.outerHTML
      };

      try {
        await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams);
        alert('✅ Relatório enviado com sucesso para impulsoflow@gmail.com!\nPDF e HTML salvos localmente.');
      } catch (error) {
        console.error('Erro ao enviar e-mail:', error);
        alert('⚠️ Relatório salvo localmente, mas houve erro no envio por e-mail.\nVerifique sua configuração do EmailJS.');
      }
    }
  </script>
</body>
</html>
